if (isEditing() && isCancelingEdit()) {
  cancelEdit();
} else if (isEditing()) {
  setViewState();
  enableEditing();
} else {
  enableEditing();
}

function isEditing() {
  return Boolean(editTodoItemForm());
}

function isCancelingEdit() {
  return "<%= @editing_todo.id %>" === editTodoItemForm().closest('.todo-item').id;
}

function editTodoItemForm() {
  return document.querySelector('textarea[name="todo_item[content]"]');
}

function cancelEdit() {
  var editingTodoItem = editTodoItemForm().closest('.todo-item');
  var editingTodoContent = editingTodoItem.querySelector('.todo-text');
  editingTodoContent.style.display = 'block';
  editingTodoItem.querySelector('.edit-form').remove();
}

function enableEditing() {
  var todoItem = document.getElementById('<%= @editing_todo.id %>');
  var todoRowLeft = todoItem.querySelector('.todo-row-left');
  todoItem.querySelector('.todo-text').style.display = 'none';
  todoRowLeft.insertAdjacentHTML(
    'afterend',
    '<%= j render 'todo_items/edit_form', todo_item: @editing_todo %>'
  );
  var textarea = todoItem.querySelector('textarea[name="todo_item[content]"]');
  var todoContent = textarea.value;
  textarea.focus();
  textarea.value = '';
  textarea.value = todoContent;
}

function setViewState() {
  for (let editForm of document.getElementsByClassName('edit-form')) {
    editForm.remove();
  }
  for (let todoText of document.getElementsByClassName('todo-text')) {
    todoText.style.display = 'block';
  }
}

